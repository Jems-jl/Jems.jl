<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>NuclearBurning.jl · Jems.jl</title><meta name="title" content="NuclearBurning.jl · Jems.jl"/><meta property="og:title" content="NuclearBurning.jl · Jems.jl"/><meta property="twitter:title" content="NuclearBurning.jl · Jems.jl"/><meta name="description" content="Documentation for Jems.jl."/><meta property="og:description" content="Documentation for Jems.jl."/><meta property="twitter:description" content="Documentation for Jems.jl."/><meta property="og:url" content="https://orlox.github.io/Jems.jl/NuclearBurning/"/><meta property="twitter:url" content="https://orlox.github.io/Jems.jl/NuclearBurning/"/><link rel="canonical" href="https://orlox.github.io/Jems.jl/NuclearBurning/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Jems.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Jems.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>NuclearBurning.jl</a><ul class="internal"><li><a class="tocitem" href="#Model-creation"><span>Model creation</span></a></li><li><a class="tocitem" href="#Initialize-StellarModel-and-evaluate-equations-and-jacobian"><span>Initialize StellarModel and evaluate equations and jacobian</span></a></li><li><a class="tocitem" href="#Benchmarking"><span>Benchmarking</span></a></li><li><a class="tocitem" href="#Evolving-our-model"><span>Evolving our model</span></a></li><li><a class="tocitem" href="#Plotting-with-Makie"><span>Plotting with Makie</span></a></li><li><a class="tocitem" href="#Compare-against-polytropes"><span>Compare against polytropes</span></a></li><li><a class="tocitem" href="#Check-nuclear-burning"><span>Check nuclear burning</span></a></li><li><a class="tocitem" href="#Plot-a-funny-HR-diagram"><span>Plot a funny HR diagram</span></a></li><li><a class="tocitem" href="#Perform-some-cleanup"><span>Perform some cleanup</span></a></li></ul></li></ul></li><li><span class="tocitem">Modules</span><ul><li><a class="tocitem" href="../Chem/">Chem</a></li><li><a class="tocitem" href="../Constants/">Constants</a></li><li><a class="tocitem" href="../EOS/">EOS</a></li><li><a class="tocitem" href="../Opacity/">Opacity</a></li><li><a class="tocitem" href="../StellarModels/">StellarModels</a></li><li><a class="tocitem" href="../Evolution/">Evolution</a></li><li><a class="tocitem" href="../Plotting/">Plotting.md</a></li></ul></li><li><span class="tocitem">Developing</span><ul><li><a class="tocitem" href="../style/">Style Guide</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>NuclearBurning.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>NuclearBurning.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/orlox/Jems.jl/blob/main/examples/NuclearBurning.jl#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="NuclearBurning.jl"><a class="docs-heading-anchor" href="#NuclearBurning.jl">NuclearBurning.jl</a><a id="NuclearBurning.jl-1"></a><a class="docs-heading-anchor-permalink" href="#NuclearBurning.jl" title="Permalink"></a></h1><p>This notebook provides a simple example of a star with simplified microphysics undergoing nuclear burning. Import all necessary Jems modules. We will also do some benchmarks, so we import BenchmarkTools as well.</p><pre><code class="language-julia hljs">using BenchmarkTools
using Jems.Chem
using Jems.Constants
using Jems.EOS
using Jems.Opacity
using Jems.NuclearNetworks
using Jems.StellarModels
using Jems.Evolution
using Jems.ReactionRates</code></pre><h2 id="Model-creation"><a class="docs-heading-anchor" href="#Model-creation">Model creation</a><a id="Model-creation-1"></a><a class="docs-heading-anchor-permalink" href="#Model-creation" title="Permalink"></a></h2><p>We start by creating the stellar model. In this example we consider a model with 6 independent variables, two of which correspond to composition. The independent variables here are <span>$\ln(P)$</span>, <span>$\ln(T)$</span>, <span>$\ln(r)$</span>, the luminosity <span>$L$</span> and the mass fractions of Hydrogen and Helium.</p><p>The Evolution module has pre-defined equations corresponding to these variables, which we provide here. For now, only a simple (fully ionized) ideal gas law EOS is available. Similarly, only a simple simple electron scattering opacity equal to <span>$\kappa=0.2(1+X)\;[\mathrm{cm^2\;g^{-1}}]$</span> is available.</p><pre><code class="language-julia hljs">varnames = [:lnρ, :lnT, :lnr, :lum]
structure_equations = [Evolution.equationHSE, Evolution.equationT,
                       Evolution.equationContinuity, Evolution.equationLuminosity]
remesh_split_functions = [StellarModels.split_lnr_lnρ, StellarModels.split_lum,
                          StellarModels.split_lnT, StellarModels.split_xa]
net = NuclearNetwork([:H1,:He4,:C12, :N14, :O16], [(:kipp_rates, :kipp_pp), (:kipp_rates, :kipp_cno)])
nz = 1000
nextra = 100
eos = EOS.IdealEOS(false)
opacity = Opacity.SimpleElectronScatteringOpacity()
sm = StellarModel(varnames, structure_equations, nz, nextra,
                  remesh_split_functions, net, eos, opacity);</code></pre><h2 id="Initialize-StellarModel-and-evaluate-equations-and-jacobian"><a class="docs-heading-anchor" href="#Initialize-StellarModel-and-evaluate-equations-and-jacobian">Initialize StellarModel and evaluate equations and jacobian</a><a id="Initialize-StellarModel-and-evaluate-equations-and-jacobian-1"></a><a class="docs-heading-anchor-permalink" href="#Initialize-StellarModel-and-evaluate-equations-and-jacobian" title="Permalink"></a></h2><p>We do not have a working initial condition yet. We require pressure, temperature profiles. One simple available initial condition is that of an n=1 polytrope. This sets the pressure and density and computes the temperature from the EOS. The luminosity is initialized by assuming pure radiative transport for the temperature gradient produced by the polytrope.</p><p>The normal evolution loop will store the information at the end of the step into an attribute of type <code>StellarStepInfo</code>, stored at <code>sm.esi</code> (<em>end step info</em>). After initializing our polytrope we can mimic that behavior by calling <code>set_end_step_info!(sm)</code>. We then &#39;cycle&#39; this info into the information of a hypothetical previous step with <code>cycle_step_info</code>, so now <code>sm.psi</code> contains our initial condition. Finally we call <code>set_start_step_info</code> to use <code>sm.psi</code> (<em>previous step info</em>) to populate the information needed before the Newton solver in <code>sm.ssi</code> (<em>start step info</em>). At last we are in position to evaluate the equations and compute the Jacobian.</p><pre><code class="language-julia hljs">StellarModels.n1_polytrope_initial_condition!(sm, MSUN, 100 * RSUN; initial_dt=10 * SECYEAR)
Evolution.set_step_info!(sm, sm.esi)
Evolution.cycle_step_info!(sm);
Evolution.set_step_info!(sm, sm.ssi)
Evolution.eval_jacobian_eqs!(sm)</code></pre><h2 id="Benchmarking"><a class="docs-heading-anchor" href="#Benchmarking">Benchmarking</a><a id="Benchmarking-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmarking" title="Permalink"></a></h2><p>The previous code leaves everything ready to solve the linearized system. For now we make use of a the serial Thomas algorithm for tridiagonal block matrices. We first show how long it takes to evaluate one row (meaning, one set of lower, diagonal and upper block) of the Jacobian matrix.</p><pre><code class="language-julia hljs">@benchmark Evolution.eval_jacobian_eqs_row!(sm, 2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BenchmarkTools.Trial: 10000 samples with 6 evaluations.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> … <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">5.368 μs</span></span> … <span class="sgr35">  9.292 μs</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>min … max<span class="sgr90">): </span>0.00% … 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">5.440 μs               </span></span><span class="sgr90">┊</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> ± <span class="sgr32">σ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">5.464 μs</span></span> ± <span class="sgr32">213.763 ns</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>mean ± σ<span class="sgr90">):  </span>0.00% ± 0.00%

  ▁▆█<span class="sgr34">▇</span><span class="sgr32">▄</span>                                                       ▂
  ███<span class="sgr34">█</span><span class="sgr32">█</span>█▇▇▇▄▅▄▅▃▄▅▆▆▆▅▃▄▄▃▄▁▃▁▁▁▁▁▃▁▁▁▁▁▁▁▄▁▁▁▃▁▁▁▁▁▁▁▁▁▃▁▁▄▅ █
  5.37 μs<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      6.88 μs <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">0 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">0</span>.</code></pre><p>On my machine, this takes <span>$\sim 3\;\mathrm{\mu s}$</span>. This is a short amount of time, but we have a thousand cells to compute. Let&#39;s benchmark the calculation of the full jacobian.</p><pre><code class="language-julia hljs">@benchmark Evolution.eval_jacobian_eqs!(sm)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BenchmarkTools.Trial: 723 samples with 1 evaluation.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> … <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">6.640 ms</span></span> … <span class="sgr35">  8.308 ms</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>min … max<span class="sgr90">): </span>0.00% … 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">6.833 ms               </span></span><span class="sgr90">┊</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> ± <span class="sgr32">σ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">6.912 ms</span></span> ± <span class="sgr32">226.109 μs</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>mean ± σ<span class="sgr90">):  </span>0.00% ± 0.00%

     ▁▅▄▇█▃▆▄<span class="sgr34">▁</span> ▂▁<span class="sgr32"> </span>                                             
  ▃▄▅████████<span class="sgr34">█</span>▇██<span class="sgr32">▆</span>██▅▅▆▅▄▄▄▄▅▃▄▃▄▃▂▃▄▃▄▃▃▃▃▂▄▃▃▃▂▂▂▃▂▃▃▂▁▂▂▃▃ ▄
  6.64 ms<span class="sgr90">         Histogram: frequency by time</span>        7.68 ms <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">656 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">7</span>.</code></pre><p>And on my computer, this took about <span>$1\;\mathrm{ms}$</span>. Even though we have a thousand cells, the computation time was not a thousand times longer than computing the components of the jacobian for a single cell. The reason for this is that the calculation is parallelized so cells are done independently. However, I used 8 cores for my calculations, so the scaling is less than ideal. One of the main culprits here is the garbage collector. Current versions of julia can only perform garbage collection in a serial way, so it does not take advantage of all threads. Starting with julia 1.10, the garbage collector will be able to run in multiple threads, so that should alleviate issues with performance scaling.</p><p>To get an idea of how much a complete iteration of the solver takes, we need to benchmark both the calculation of the Jacobian and the matrix solver. This is because the matrix solver is destructive, as it uses the allocated Jacobian to store intermediate results. The time it takes to run only the matrix solver can be determined by substracting the previous benchmark from this one.</p><pre><code class="language-julia hljs">@benchmark begin
    Evolution.eval_jacobian_eqs!($sm)
    Evolution.thomas_algorithm!($sm)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BenchmarkTools.Trial: 505 samples with 1 evaluation.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> … <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">9.217 ms</span></span> … <span class="sgr35">14.335 ms</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>min … max<span class="sgr90">): </span>0.00% … 20.22%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">9.487 ms              </span></span><span class="sgr90">┊</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> ± <span class="sgr32">σ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">9.898 ms</span></span> ± <span class="sgr32"> 1.035 ms</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>mean ± σ<span class="sgr90">):  </span>2.20% ±  5.84%

  ▅██▇<span class="sgr34">▆</span>▄▂▂▁<span class="sgr32">▂</span>▂▂                                                
  ████<span class="sgr34">█</span>████<span class="sgr32">█</span>████▆▅▆█▆▆▄▁▁▅▆▅▄▄▄▆▄▄▁▄▁▁▁▁▁▄▁▁▁▅▆▅▇▄▄▅▁█▆▅▅▄▆▅ █
  9.22 ms<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>     13.6 ms <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">4.69 MiB</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">24007</span>.</code></pre><h2 id="Evolving-our-model"><a class="docs-heading-anchor" href="#Evolving-our-model">Evolving our model</a><a id="Evolving-our-model-1"></a><a class="docs-heading-anchor-permalink" href="#Evolving-our-model" title="Permalink"></a></h2><p>We can now evolve our star! We will initiate a <span>$1M_\odot$</span> star with a radius of <span>$100R_\odot$</span> using an n=1 polytrope (it would be much better to use n=3 or n=3/2 polytropes, for now I only use this because there is a simple analytical solution). The star is expected to contract until it ignites hydrogen. We set a few options for the simulation with a toml file, which we generate dynamically. These simulation should complete in about a thousand steps once it reaches the <code>max_center_T</code> limit.</p><p>Output is stored in HDF5 files, and easy to use functions are provided with the Evolution module to turn these HDF5 files into DataFrame objects. HDF5 output is compressed by default.</p><pre><code class="language-julia hljs">open(&quot;example_options.toml&quot;, &quot;w&quot;) do file
    write(file,
          &quot;&quot;&quot;
          [remesh]
          do_remesh = true

          [solver]
          newton_max_iter_first_step = 1000
          newton_max_iter = 200

          [timestep]
          dt_max_increase = 10.0
          delta_R_limit = 0.01
          delta_Tc_limit = 0.01

          [termination]
          max_model_number = 2000
          max_center_T = 4e7

          [plotting]
          do_plotting = false
          wait_at_termination = false
          plotting_interval = 1

          window_specs = [&quot;HR&quot;, &quot;profile&quot;, &quot;history&quot;]
          window_layouts = [[1, 1],  # arrangement of plots
                            [2, 1],
                            [3, 1]
                            ]

          profile_xaxis = &#39;mass&#39;
          profile_yaxes = [&#39;log10_T&#39;]
          profile_alt_yaxes = [&#39;X&#39;,&#39;Y&#39;]

          history_xaxis = &#39;star_age&#39;
          history_yaxes = [&#39;R_surf&#39;]
          history_alt_yaxes = [&#39;T_center&#39;]

          [io]
          profile_interval = 50

          &quot;&quot;&quot;)
end
StellarModels.set_options!(sm.opt, &quot;./example_options.toml&quot;)
rm(sm.opt.io.hdf5_history_filename; force=true)
rm(sm.opt.io.hdf5_profile_filename; force=true)
StellarModels.n1_polytrope_initial_condition!(sm, 1 * MSUN, 100 * RSUN; initial_dt=1000 * SECYEAR)
@time Evolution.do_evolution_loop(sm);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(i, maximum(corr), real_max_corr, maximum(sm.eqs_numbers)) = (50, 0.050257952037296424, 1.3033146550107524, 62.21439219540352)
(i, maximum(corr), real_max_corr, maximum(sm.eqs_numbers)) = (100, 2.376662750767359, 2.376662750767359, 42.56333480814986)
(i, maximum(corr), real_max_corr, maximum(sm.eqs_numbers)) = (150, 1.015731834666432, 1.015731834666432, 10.991917914474755)
Found first model
    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
        1     3.000   -0.4575     2.608    0.5024    -10.32     1.000       163
    1.000     1000. 1.857e-10     4.743     7.737    -5.224 1.494e-45      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
       10     1.885    0.2365     2.748    0.3697    -10.60     1.000         3
    1.000     2266. 1.866e-10     4.739     7.799    -5.158 3.175e-45      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
       20     2.279    0.4481     2.788    0.3172    -10.69     1.000         3
    1.000     3559. 1.870e-10     4.744     7.871    -5.090 5.401e-45      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
       30     2.627    0.6050     2.828    0.3222    -10.72     1.000         3
    1.000     6711. 1.870e-10     4.776     8.066    -4.927 3.800e-44      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
       40     2.589    0.6600     2.864    0.4085    -10.67     1.000         3
    1.000 1.101e+04 1.863e-10     4.830     8.324    -4.723 1.718e-42      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
       50     2.578    0.6762     2.889    0.4950    -10.61     1.000         3
    1.000 1.479e+04 1.857e-10     4.877     8.527    -4.567 4.530e-41      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
       60     2.600    0.6838     2.913    0.5809    -10.55     1.000         3
    1.000 1.868e+04 1.851e-10     4.922     8.715    -4.425 9.664e-40      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
       70     2.633    0.6877     2.935    0.6667    -10.49     1.000         3
    1.000 2.283e+04 1.845e-10     4.966     8.896    -4.288 1.805e-38      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
       80     2.671    0.6900     2.957    0.7524    -10.42     1.000         3
    1.000 2.733e+04 1.839e-10     5.009     9.073    -4.154 3.034e-37      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
       90     2.710    0.6913     2.979    0.8380    -10.36     1.000         3
    1.000 3.226e+04 1.832e-10     5.053     9.249    -4.021 4.655e-36      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      100     2.752    0.6921     3.001    0.9236    -10.29     1.000         3
    1.000 3.767e+04 1.826e-10     5.096     9.423    -3.890 6.568e-35      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      110     2.794    0.6926     3.022     1.009    -10.23     1.000         3
    1.000 4.362e+04 1.820e-10     5.139     9.597    -3.760 8.566e-34      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      120     2.836    0.6929     3.044     1.095    -10.17     1.000         3
    1.000 5.018e+04 1.814e-10     5.183     9.771    -3.629 1.037e-32      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      130     2.878    0.6931     3.065     1.180    -10.10     1.000         3
    1.000 5.741e+04 1.808e-10     5.226     9.944    -3.500 1.168e-31      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      140     2.921    0.6932     3.087     1.266    -10.04     1.000         3
    1.000 6.540e+04 1.802e-10     5.269     10.12    -3.370 1.228e-30      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      150     2.964    0.6933     3.108     1.352    -9.974     1.000         3
    1.000 7.420e+04 1.796e-10     5.312     10.29    -3.240 1.208e-29      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      160     3.007    0.6933     3.129     1.437    -9.910     1.000         3
    1.000 8.392e+04 1.789e-10     5.355     10.46    -3.111 1.115e-28      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      170     3.050    0.6934     3.151     1.523    -9.845     1.000         3
    1.000 9.465e+04 1.783e-10     5.398     10.63    -2.981 9.677e-28      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      180     3.093    0.6934     3.172     1.608    -9.781     1.000         3
    1.000 1.065e+05 1.777e-10     5.442     10.81    -2.852 7.912e-27      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      190     3.136    0.6934     3.194     1.694    -9.717     1.000         3
    1.000 1.196e+05 1.771e-10     5.485     10.98    -2.723 6.107e-26      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      200     3.178    0.6934     3.215     1.780    -9.653     1.000         3
    1.000 1.340e+05 1.765e-10     5.528     11.15    -2.594 4.459e-25      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      210     3.221    0.6934     3.236     1.865    -9.589     1.000         3
    1.000 1.499e+05 1.759e-10     5.571     11.32    -2.464 3.086e-24      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      220     3.264    0.6934     3.258     1.951    -9.525     1.000         3
    1.000 1.675e+05 1.753e-10     5.614     11.50    -2.335 2.027e-23      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      230     3.307    0.6934     3.279     2.036    -9.460     1.000         3
    1.000 1.869e+05 1.746e-10     5.657     11.67    -2.206 1.267e-22      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      240     3.350    0.6934     3.301     2.122    -9.396     1.000         3
    1.000 2.084e+05 1.740e-10     5.700     11.84    -2.077 7.539e-22      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      250     3.393    0.6934     3.322     2.207    -9.332     1.000         3
    1.000 2.320e+05 1.734e-10     5.743     12.01    -1.948 4.282e-21      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      260     3.436    0.6934     3.343     2.293    -9.268     1.000         3
    1.000 2.581e+05 1.728e-10     5.786     12.18    -1.819 2.324e-20      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      270     3.479    0.6934     3.365     2.379    -9.204     1.000         3
    1.000 2.870e+05 1.722e-10     5.829     12.36    -1.690 1.208e-19      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      280     3.522    0.6934     3.386     2.464    -9.139     1.000         3
    1.000 3.188e+05 1.716e-10     5.872     12.53    -1.561 6.014e-19      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      290     3.565    0.6934     3.407     2.550    -9.075     1.000         3
    1.000 3.539e+05 1.709e-10     5.915     12.70    -1.432 2.875e-18      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      300     3.606    0.6934     3.428     2.631    -9.014     1.000         3
    1.000 3.907e+05 1.704e-10     5.956     12.86    -1.310 1.227e-17      1005

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      310     3.649    0.6934     3.449     2.717    -8.950     1.000         4
    1.000 4.333e+05 1.697e-10     5.999     13.04    -1.181 5.438e-17      1006

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      320     3.689    0.6934     3.470     2.798    -8.889     1.000         3
    1.000 4.780e+05 1.692e-10     6.040     13.20    -1.058 2.163e-16      1006

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      330     3.732    0.6934     3.491     2.884    -8.825     1.000         3
    1.000 5.296e+05 1.685e-10     6.082     13.37   -0.9291 8.923e-16      1007

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      340     3.773    0.6934     3.511     2.965    -8.763     1.000         3
    1.000 5.837e+05 1.680e-10     6.123     13.53   -0.8066 3.324e-15      1007

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      350     3.825    0.6934     3.532     3.047    -8.702     1.000         3
    1.000 6.432e+05 1.674e-10     6.164     13.70   -0.6841 1.201e-14      1008

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      360     3.854    0.6934     3.552     3.128    -8.641     1.000         3
    1.000 7.085e+05 1.668e-10     6.205     13.86   -0.5616 4.213e-14      1009

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      370     3.895    0.6934     3.572     3.210    -8.580     1.000         3
    1.000 7.803e+05 1.662e-10     6.246     14.02   -0.4391 1.436e-13      1010

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      380     3.938    0.6934     3.594     3.295    -8.516     1.000         3
    1.000 8.632e+05 1.656e-10     6.289     14.20   -0.3104 5.062e-13      1010

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      390     3.990    0.6934     3.614     3.377    -8.455     1.000         3
    1.000 9.502e+05 1.650e-10     6.330     14.36   -0.1880 1.632e-12      1011

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      400     4.022    0.6934     3.636     3.462    -8.391     1.000         3
    1.000 1.051e+06 1.644e-10     6.372     14.53  -0.05926 5.432e-12      1011

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      410     4.062    0.6934     3.656     3.544    -8.330     1.000         3
    1.000 1.156e+06 1.638e-10     6.413     14.69   0.06315 1.661e-11      1012

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      420     4.116    0.6934     3.675     3.619    -8.273     1.000         3
    1.000 1.263e+06 1.633e-10     6.451     14.84    0.1759 4.555e-11      1014

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      430     4.141    0.6934     3.695     3.700    -8.212     1.000         3
    1.000 1.389e+06 1.627e-10     6.492     15.01    0.2983 1.330e-10      1015

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      440     4.184    0.6934     3.717     3.786    -8.148     1.000         3
    1.000 1.535e+06 1.621e-10     6.535     15.18    0.4270 4.007e-10      1017

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      450     4.224    0.6934     3.737     3.867    -8.087     1.000         3
    1.000 1.688e+06 1.615e-10     6.575     15.34    0.5493 1.117e-09      1017

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      460     4.265    0.6934     3.757     3.949    -8.026     1.000         3
    1.000 1.856e+06 1.609e-10     6.616     15.51    0.6716 3.050e-09      1018

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      470     4.306    0.6934     3.778     4.030    -7.965     1.000         3
    1.000 2.041e+06 1.603e-10     6.657     15.67    0.7940 8.156e-09      1020

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      480     4.355    0.6934     3.797     4.107    -7.907     1.000         3
    1.000 2.233e+06 1.598e-10     6.696     15.82    0.9100 2.035e-08      1021

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      490     4.387    0.6934     3.818     4.193    -7.843     1.000         3
    1.000 2.466e+06 1.591e-10     6.738     15.99     1.039 5.493e-08      1021

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      500     4.123    0.6933     3.838     4.270    -7.785     1.000         3
    1.000 2.698e+06 1.586e-10     6.777     16.15     1.154 1.318e-07      1023

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      510     4.467    0.6933     3.858     4.352    -7.724     1.000         3
    1.000 2.966e+06 1.580e-10     6.818     16.31     1.276 3.276e-07      1024

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      520     4.508    0.6931     3.878     4.433    -7.663     1.000         3
    1.000 3.260e+06 1.574e-10     6.859     16.47     1.398 7.978e-07      1025

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      530     4.552    0.6926     3.899     4.518    -7.598     1.000         3
    1.000 3.601e+06 1.568e-10     6.902     16.64     1.525 1.997e-06      1027

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      540     4.594    0.6917     3.919     4.596    -7.540     1.000         3
    1.000 3.941e+06 1.562e-10     6.941     16.80     1.639 4.502e-06      1028

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      550     4.643    0.6897     3.939     4.681    -7.476    1.0000         3
    1.000 4.358e+06 1.556e-10     6.984     16.96     1.761 1.091e-05      1028

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      560     4.696    0.6855     3.959     4.762    -7.414    1.0000         3
    1.000 4.805e+06 1.551e-10     7.025     17.11     1.871 2.497e-05      1029

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      570     4.755    0.6778     3.975     4.837    -7.356    0.9999         3
    1.000 5.274e+06 1.545e-10     7.064     17.24     1.963 5.304e-05      1031

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      580     4.847    0.6614     3.991     4.917    -7.292    0.9999         3
    1.000 5.880e+06 1.539e-10     7.106     17.37     2.042 0.0001195      1032

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      590     4.688    0.6288     4.003     4.996    -7.224    0.9997         4
    1.000 6.680e+06 1.534e-10     7.143     17.45     2.095 0.0002689      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      600     5.419    0.5597     4.005     5.073    -7.149    0.9993         3
    1.000 8.271e+06 1.528e-10     7.165     17.50     2.116 0.0006937      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      610     8.445    0.6015     4.010     5.051    -7.176    0.6284         4
    1.000 1.326e+09 1.530e-10     7.221     17.61     2.282    0.3716      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      620     8.061    0.7553     4.024     4.956    -7.286    0.2221         3
    1.000 3.022e+09 1.537e-10     7.309     17.96     2.724    0.7779      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      630     7.756    0.8691     4.030     4.862    -7.385   0.08924         3
    1.000 3.815e+09 1.543e-10     7.386     18.34     3.097    0.9108      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      640     7.486    0.9542     4.028     4.769    -7.476   0.04058         3
    1.000 4.224e+09 1.550e-10     7.455     18.70     3.422    0.9594      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      650     7.241     1.018     4.020     4.677    -7.561   0.02026         3
    1.000 4.450e+09 1.557e-10     7.521     19.05     3.717    0.9797      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      660     7.014     1.067     4.010     4.585    -7.642   0.01084         3
    1.000 4.582e+09 1.563e-10     7.585     19.38     3.990    0.9892      1033

Reached maximum central temperature
 40.314756 seconds (230.60 M allocations: 16.208 GiB, 3.75% gc time, 13.75% compilation time: &lt;1% of which was recompilation)</code></pre><h2 id="Plotting-with-Makie"><a class="docs-heading-anchor" href="#Plotting-with-Makie">Plotting with Makie</a><a id="Plotting-with-Makie-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-with-Makie" title="Permalink"></a></h2><p>Now that our simulation is complete we can analyze the results. We make use of the Makie package for this. I&#39;m not a fan of the Makie defaults, so I adjust them. I normally also adjust the fonts to be consistent with \LaTeX, but I avoid that here so we don&#39;t need to distribute those fonts together with Jems.</p><pre><code class="language-julia hljs">using CairoMakie, LaTeXStrings, MathTeXEngine
basic_theme = Theme(fonts=(regular=texfont(:text), bold=texfont(:bold),
                           italic=texfont(:italic), bold_italic=texfont(:bolditalic)),
                    fontsize=30, resolution=(1000, 750), linewidth=7,
                    Axis=(xlabelsize=40, ylabelsize=40, titlesize=40, xgridvisible=false, ygridvisible=false,
                          spinewidth=2.5, xminorticksvisible=true, yminorticksvisible=true, xtickalign=1, ytickalign=1,
                          xminortickalign=1, yminortickalign=1, xticksize=14, xtickwidth=2.5, yticksize=14,
                          ytickwidth=2.5, xminorticksize=7, xminortickwidth=2.5, yminorticksize=7, yminortickwidth=2.5,
                          xticklabelsize=35, yticklabelsize=35, xticksmirrored=true, yticksmirrored=true),
                    Legend=(patchsize=(70, 10), framevisible=false, patchlabelgap=20, rowgap=10))
set_theme!(basic_theme)</code></pre><h2 id="Compare-against-polytropes"><a class="docs-heading-anchor" href="#Compare-against-polytropes">Compare against polytropes</a><a id="Compare-against-polytropes-1"></a><a class="docs-heading-anchor-permalink" href="#Compare-against-polytropes" title="Permalink"></a></h2><p>Below we see how the profile of the star compares to different polytropes. We make use of the facility tools to obtain DataFrame objects out of the hdf5 output. In particular, <code>get_profile_names_from_hdf5</code> will provide the names of all profiles contained within the hdf5 file, while <code>get_profile_dataframe_from_hdf5</code> is used to obtain one DataFrame corresponding to one stellar profile. The animation is constructed using the <code>Observable</code> type that makie provides. Note that the zero points of the polytropes are arbitrary.</p><pre><code class="language-julia hljs">profile_names = StellarModels.get_profile_names_from_hdf5(&quot;profiles.hdf5&quot;)

f = Figure();
ax = Axis(f[1, 1]; xlabel=L&quot;\log_{10}(\rho/\mathrm{[g\;cm^{-3}]})&quot;, ylabel=L&quot;\log_{10}(P/\mathrm{[dyn]})&quot;)

pname = Observable(profile_names[1])

profile = @lift(StellarModels.get_profile_dataframe_from_hdf5(&quot;profiles.hdf5&quot;, $pname))
#To see why this is done this way, see https://docs.makie.org/stable/explanations/nodes/index.html#problems_with_synchronous_updates
#the main issue is that remeshing changes the size of the arrays
log10_ρ = @lift($profile[!, &quot;log10_ρ&quot;])
log10_P = Observable(rand(length(log10_ρ.val)))

profile_line = lines!(ax, log10_ρ, log10_P; label=&quot;real profile&quot;)
xvals = LinRange(-13, 4, 100)
lines!(ax, xvals, (1 + 1 / 1) .* xvals .+ 20; label=&quot;n=1&quot;)
lines!(ax, xvals, (1 + 1 / (1.5)) .* xvals .+ 15; label=&quot;n=1.5&quot;)
lines!(ax, xvals, (1 + 1 / 3) .* xvals .+ 15; label=&quot;n=3&quot;)
axislegend(ax; position=:rb)

model_number_str = @lift(&quot;model number=$(parse(Int,$pname))&quot;)
profile_text = text!(ax, -10, 20; text=model_number_str)

record(f, &quot;rho_P_evolution.gif&quot;, profile_names[1:end]; framerate=2) do profile_name
    profile = StellarModels.get_profile_dataframe_from_hdf5(&quot;profiles.hdf5&quot;, profile_name)
    log10_P.val = profile[!, &quot;log10_P&quot;]
    pname[] = profile_name
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;rho_P_evolution.gif&quot;</code></pre><p><img src="../rho_P_evolution.gif" alt="Movie polytrope"/></p><h2 id="Check-nuclear-burning"><a class="docs-heading-anchor" href="#Check-nuclear-burning">Check nuclear burning</a><a id="Check-nuclear-burning-1"></a><a class="docs-heading-anchor-permalink" href="#Check-nuclear-burning" title="Permalink"></a></h2><p>We see that the structure evolves towards an n=3 polytrope. Deviations near the core are due to the non-homogeneous composition as hydrogen is burnt. We can similarly visualize how the hydrogen mass fraction changes in the simulation. In here, only one frame shows the hydrogen that was burnt. To better visualize that you can adjust <code>profile_interval</code> in the <a href="../Evolution/##Io.jl">IO</a> options (and probably adjust the framerate).</p><pre><code class="language-julia hljs">profile_names = StellarModels.get_profile_names_from_hdf5(&quot;profiles.hdf5&quot;)

f = Figure();
ax = Axis(f[1, 1]; xlabel=L&quot;\mathrm{Mass}\;[M_\odot]&quot;, ylabel=L&quot;X&quot;)

pname = Observable(profile_names[1])

profile = @lift(StellarModels.get_profile_dataframe_from_hdf5(&quot;profiles.hdf5&quot;, $pname))
mass = @lift($profile[!, &quot;mass&quot;])
X = Observable(rand(length(mass.val)))
model_number_str = @lift(&quot;model number=$(parse(Int,$pname))&quot;)

profile_line = lines!(ax, mass, X; label=&quot;real profile&quot;)
profile_text = text!(ax, 0.7, 0.0; text=model_number_str)

record(f, &quot;X_evolution.gif&quot;, profile_names[1:end]; framerate=2) do profile_name
    profile = StellarModels.get_profile_dataframe_from_hdf5(&quot;profiles.hdf5&quot;, profile_name)
    X.val = profile[!, &quot;X&quot;]
    pname[] = profile_name
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;X_evolution.gif&quot;</code></pre><p><img src="../X_evolution.gif" alt="Movie polytrope"/></p><h2 id="Plot-a-funny-HR-diagram"><a class="docs-heading-anchor" href="#Plot-a-funny-HR-diagram">Plot a funny HR diagram</a><a id="Plot-a-funny-HR-diagram-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-a-funny-HR-diagram" title="Permalink"></a></h2><p>Finally, we can also access the history data of the simulation. We use this to plot a simple HR diagram. As our microphysics are very simplistic, and the initial condition is not very physical, this looks a bit funny!</p><pre><code class="language-julia hljs">f = Figure();
ax = Axis(f[1, 1]; xlabel=L&quot;\log_{10}(T_\mathrm{eff}/[K])&quot;, ylabel=L&quot;\log_{10}(L/L_\odot)&quot;, xreversed=true)
history = StellarModels.get_history_dataframe_from_hdf5(&quot;history.hdf5&quot;)
lines!(ax, log10.(history[!, &quot;T_surf&quot;]), log10.(history[!, &quot;L_surf&quot;]))
f</code></pre><img src="511024d6.png" alt="Example block output"/><h2 id="Perform-some-cleanup"><a class="docs-heading-anchor" href="#Perform-some-cleanup">Perform some cleanup</a><a id="Perform-some-cleanup-1"></a><a class="docs-heading-anchor-permalink" href="#Perform-some-cleanup" title="Permalink"></a></h2><p>Internally we want to prevent storing any of the hdf5 files into our git repos, so I remove them. You can also take advantage of <code>julia</code> as a scripting language to post-process your simulation output in a similar way.</p><pre><code class="language-julia hljs">rm(&quot;history.hdf5&quot;)
rm(&quot;profiles.hdf5&quot;)
rm(&quot;example_options.toml&quot;)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../Chem/">Chem »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Monday 27 November 2023 08:53">Monday 27 November 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
