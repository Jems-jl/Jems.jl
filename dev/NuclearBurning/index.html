<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>NuclearBurning.jl · Jems.jl</title><meta name="title" content="NuclearBurning.jl · Jems.jl"/><meta property="og:title" content="NuclearBurning.jl · Jems.jl"/><meta property="twitter:title" content="NuclearBurning.jl · Jems.jl"/><meta name="description" content="Documentation for Jems.jl."/><meta property="og:description" content="Documentation for Jems.jl."/><meta property="twitter:description" content="Documentation for Jems.jl."/><meta property="og:url" content="https://Jems-jl.github.io/NuclearBurning/"/><meta property="twitter:url" content="https://Jems-jl.github.io/NuclearBurning/"/><link rel="canonical" href="https://Jems-jl.github.io/NuclearBurning/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Jems.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Jems.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../DualNumbers/">DualSupport.jl</a></li><li class="is-active"><a class="tocitem" href>NuclearBurning.jl</a><ul class="internal"><li><a class="tocitem" href="#Model-creation"><span>Model creation</span></a></li><li><a class="tocitem" href="#Initialize-StellarModel-and-evaluate-equations-and-jacobian"><span>Initialize StellarModel and evaluate equations and jacobian</span></a></li><li><a class="tocitem" href="#Benchmarking"><span>Benchmarking</span></a></li><li><a class="tocitem" href="#Evolving-our-model"><span>Evolving our model</span></a></li><li><a class="tocitem" href="#Plotting-with-Makie"><span>Plotting with Makie</span></a></li></ul></li></ul></li><li><span class="tocitem">Modules</span><ul><li><a class="tocitem" href="../Chem/">Chem</a></li><li><a class="tocitem" href="../Constants/">Constants</a></li><li><a class="tocitem" href="../DualSupport/">DualSupport</a></li><li><a class="tocitem" href="../EOS/">EOS</a></li><li><a class="tocitem" href="../Evolution/">Evolution</a></li><li><a class="tocitem" href="../Opacity/">Opacity</a></li><li><a class="tocitem" href="../Plotting/">Plotting</a></li><li><a class="tocitem" href="../ReactionRates/">ReactionRates</a></li><li><a class="tocitem" href="../StellarModels/">StellarModels</a></li><li><a class="tocitem" href="../Turbulence/">Turbulence</a></li></ul></li><li><span class="tocitem">Developing</span><ul><li><a class="tocitem" href="../style/">Style Guide</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>NuclearBurning.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>NuclearBurning.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Jems-jl/Jems.jl/blob/main/examples/NuclearBurning.jl#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="NuclearBurning.jl"><a class="docs-heading-anchor" href="#NuclearBurning.jl">NuclearBurning.jl</a><a id="NuclearBurning.jl-1"></a><a class="docs-heading-anchor-permalink" href="#NuclearBurning.jl" title="Permalink"></a></h1><p>This notebook provides a simple example of a star with simplified microphysics undergoing nuclear burning. Import all necessary Jems modules. We will also do some benchmarks, so we import BenchmarkTools as well.</p><pre><code class="language-julia hljs">using BenchmarkTools
using Jems.Chem
using Jems.Constants
using Jems.EOS
using Jems.Opacity
using Jems.NuclearNetworks
using Jems.Turbulence
using Jems.StellarModels
using Jems.Evolution
using Jems.Plotting</code></pre><h2 id="Model-creation"><a class="docs-heading-anchor" href="#Model-creation">Model creation</a><a id="Model-creation-1"></a><a class="docs-heading-anchor-permalink" href="#Model-creation" title="Permalink"></a></h2><p>We start by creating the stellar model. In this example we consider a model with 6 independent variables, two of which correspond to composition. The independent variables here are <span>$\ln(P)$</span>, <span>$\ln(T)$</span>, <span>$\ln(r)$</span>, the luminosity <span>$L$</span> and the mass fractions of Hydrogen and Helium.</p><p>The Evolution module has pre-defined equations corresponding to these variables, which we provide here. For now, only a simple (fully ionized) ideal gas law EOS is available. Similarly, only a simple simple electron scattering opacity equal to <span>$\kappa=0.2(1+X)\;[\text{cm^2\;g^{-1}}]$</span> is available.</p><pre><code class="language-julia hljs">varnames = [:lnρ, :lnT, :lnr, :lum]
varscaling = [:log, :log, :log, :maxval]
structure_equations = [Evolution.equationHSE, Evolution.equationT,
                       Evolution.equationContinuity, Evolution.equationLuminosity]
remesh_split_functions = [StellarModels.split_lnr_lnρ, StellarModels.split_lum,
                          StellarModels.split_lnT, StellarModels.split_xa]
net = NuclearNetwork([:H1, :He4, :C12, :N14, :O16], [(:kipp_rates, :kipp_pp), (:kipp_rates, :kipp_cno)])
nz = 1000
nextra = 100
eos = EOS.IdealEOS(true)
opacity = Opacity.SimpleElectronScatteringOpacity()
turbulence = Turbulence.BasicMLT(1.0)
sm = StellarModel(varnames, varscaling, structure_equations, Evolution.equation_composition,
                    nz, nextra, remesh_split_functions, net, eos, opacity, turbulence);</code></pre><h2 id="Initialize-StellarModel-and-evaluate-equations-and-jacobian"><a class="docs-heading-anchor" href="#Initialize-StellarModel-and-evaluate-equations-and-jacobian">Initialize StellarModel and evaluate equations and jacobian</a><a id="Initialize-StellarModel-and-evaluate-equations-and-jacobian-1"></a><a class="docs-heading-anchor-permalink" href="#Initialize-StellarModel-and-evaluate-equations-and-jacobian" title="Permalink"></a></h2><p>We do not have a working initial condition yet. We require pressure, temperature profiles. One simple available initial condition is that of an n=1 polytrope. This sets the pressure and density and computes the temperature from the EOS. The luminosity is initialized by assuming pure radiative transport for the temperature gradient produced by the polytrope. Information of the model at its present and following step are required at the beginning, the function <code>compute_starting_model_properties!</code> takes care of setting this up.</p><pre><code class="language-julia hljs">n = 3
StellarModels.n_polytrope_initial_condition!(n, sm, nz, 0.7154, 0.0142, 0.0, Chem.abundance_lists[:ASG_09], MSUN,
                                             100 * RSUN; initial_dt=10 * SECYEAR)
Evolution.compute_starting_model_properties!(sm)</code></pre><h2 id="Benchmarking"><a class="docs-heading-anchor" href="#Benchmarking">Benchmarking</a><a id="Benchmarking-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmarking" title="Permalink"></a></h2><p>The previous code leaves everything ready to solve the linearized system. For now we make use of a the serial Thomas algorithm for tridiagonal block matrices. We first show how long it takes to evaluate the Jacobian matrix. This requires two steps, the first is to evaluate properties across the model (for example, the EOS) and then evaluate all differential equations and fill the Jacobian. We first benchmark the evaluation of model properties:</p><pre><code class="language-julia hljs">@benchmark begin
    StellarModels.evaluate_stellar_model_properties!($sm, $sm.props)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BenchmarkTools.Trial: 1139 samples with 1 evaluation per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> … <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">3.720 ms</span></span> … <span class="sgr35">  5.615 ms</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>min … max<span class="sgr90">): </span>0.00% … 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">4.350 ms               </span></span><span class="sgr90">┊</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> ± <span class="sgr32">σ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">4.375 ms</span></span> ± <span class="sgr32">228.843 μs</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>mean ± σ<span class="sgr90">):  </span>0.00% ± 0.00%

                   ▃▁▄▃▄▅▅█▇▆▄<span class="sgr34">▆</span><span class="sgr32">▅</span>▄▃▆▅▃ ▃▁                       
  ▂▂▁▂▃▃▂▂▂▂▃▂▃▃▄▇▇███████████<span class="sgr34">█</span><span class="sgr32">█</span>█████████▆█▅▄▃▄▅▄▄▄▄▃▃▂▃▃▃▂▄▃ ▅
  3.72 ms<span class="sgr90">         Histogram: frequency by time</span>        5.03 ms <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">896 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">14</span>.</code></pre><p>And next we benchmark the evaluation of the model equations and construction of the Jacobian:</p><pre><code class="language-julia hljs">@benchmark begin
    Evolution.eval_jacobian_eqs!($sm)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BenchmarkTools.Trial: 2070 samples with 1 evaluation per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> … <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">1.947 ms</span></span> … <span class="sgr35">  5.938 ms</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>min … max<span class="sgr90">): </span>0.00% … 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">2.308 ms               </span></span><span class="sgr90">┊</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> ± <span class="sgr32">σ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">2.413 ms</span></span> ± <span class="sgr32">387.095 μs</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>mean ± σ<span class="sgr90">):  </span>0.00% ± 0.00%

     ▃▄▇█▄▆▃▃▁<span class="sgr34">▂</span> ▃<span class="sgr32">▁</span>                                             
  ▄▇██████████<span class="sgr34">█</span>██<span class="sgr32">█</span>▇█▆▆▆▅▆▅▄▄▄▃▃▂▄▃▃▃▃▂▂▂▂▁▂▁▁▂▂▂▁▁▂▁▁▁▁▂▂▂▂▁▁ ▃
  1.95 ms<span class="sgr90">         Histogram: frequency by time</span>        3.72 ms <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">432 bytes</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">7</span>.</code></pre><p>To benchmark the linear solver itself we need to perform the jacobian evaluation as a setup for the benchmark. This is because the solver destroys the Jacobian to perform in-place operations.</p><pre><code class="language-julia hljs">@benchmark begin
    Evolution.thomas_algorithm!($sm)
end setup=(Evolution.eval_jacobian_eqs!($sm))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BenchmarkTools.Trial: 1062 samples with 1 evaluation per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> … <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">1.370 ms</span></span> … <span class="sgr35"> 1.870 ms</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>min … max<span class="sgr90">): </span>0.00% … 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">1.571 ms              </span></span><span class="sgr90">┊</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> ± <span class="sgr32">σ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">1.560 ms</span></span> ± <span class="sgr32">87.090 μs</span>  <span class="sgr90">┊</span> GC <span class="sgr90">(</span>mean ± σ<span class="sgr90">):  </span>0.00% ± 0.00%

    ▂            ▃  ▂ ▂▄▁▅▂▁  ▃▁▁<span class="sgr32">▇</span>▄<span class="sgr34">▅</span>█▅▅▄▇▇▅▇█▃▅▁▁▁▁           
  ▆▇█▆▄▃▃▅▆▅▄▃▃█▇█▇▇█▇███████▇███<span class="sgr32">█</span>█<span class="sgr34">█</span>█████████████████▇█▄▆▂▃▃ ▅
  1.37 ms<span class="sgr90">        Histogram: frequency by time</span>        1.72 ms <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">125.00 KiB</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">2000</span>.</code></pre><h2 id="Evolving-our-model"><a class="docs-heading-anchor" href="#Evolving-our-model">Evolving our model</a><a id="Evolving-our-model-1"></a><a class="docs-heading-anchor-permalink" href="#Evolving-our-model" title="Permalink"></a></h2><p>We can now evolve our star! We will initiate a <span>$1M_\odot$</span> star with a radius of <span>$100R_\odot$</span> using an n=3 polytrope. The star is expected to contract until it ignites hydrogen. We set a few options for the simulation with a toml file, which we generate dynamically. These simulation should complete in about a thousand steps once it reaches the <code>max_center_T</code> limit.</p><p>Output is stored in HDF5 files, and easy to use functions are provided with the <code>StellarModels</code> module to turn these HDF5 files into DataFrame objects. HDF5 output is compressed by default.</p><pre><code class="language-julia hljs">open(&quot;example_options.toml&quot;, &quot;w&quot;) do file
    write(file,
          &quot;&quot;&quot;
          [remesh]
          do_remesh = true

          [solver]
          newton_max_iter_first_step = 1000
          initial_model_scale_max_correction = 0.2
          newton_max_iter = 10
          scale_max_correction = 0.1

          [timestep]
          dt_max_increase = 1.5
          delta_R_limit = 0.01
          delta_Tc_limit = 0.01
          delta_Xc_limit = 0.005

          [termination]
          max_model_number = 2000
          max_center_T = 1e8

          [io]
          profile_interval = 50
          terminal_header_interval = 100
          terminal_info_interval = 100

          &quot;&quot;&quot;)
end
StellarModels.set_options!(sm.opt, &quot;./example_options.toml&quot;)
rm(sm.opt.io.hdf5_history_filename; force=true)
rm(sm.opt.io.hdf5_profile_filename; force=true)


#Configure live plots. To turn off one can use `plotter = Plotting.NullPlotter()`
using GLMakie
GLMakie.activate!()
set_theme!(Plotting.basic_theme())
f = Figure(size=(1400,750))
plots = [Plotting.HRPlot(f[1,1]),
         Plotting.TRhoProfile(f[1,2]),
         Plotting.KippenLine(f[2,1], xaxis=:time, time_units=:Gyr),
         Plotting.AbundancePlot(f[2,2],net,log_yscale=true, ymin=1e-3),
         Plotting.HistoryPlot(f[1,3], sm, x_name=&quot;age&quot;, y_name=&quot;X_center&quot;, othery_name=&quot;Y_center&quot;, link_yaxes=true),
         Plotting.ProfilePlot(f[2,3], sm, x_name=&quot;mass&quot;, y_name=&quot;log10_rho&quot;, othery_name=&quot;log10_T&quot;)]
plotter = Plotting.Plotter(fig=f,plots=plots)


#set initial condition and run model
n = 3
StellarModels.n_polytrope_initial_condition!(n, sm, nz, 0.7154, 0.0142, 0.0, Chem.abundance_lists[:ASG_09],
                                            1 * MSUN, 100 * RSUN; initial_dt=10 * SECYEAR)
@time Evolution.do_evolution_loop!(sm, plotter=plotter);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Found first model
    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
        1     1.000     1.205     3.069    0.7508    -10.45    0.7154        23
    1.000     10.00     1.988     5.080     9.096    -4.116    0.2704      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      100     2.617     1.103     3.243     1.549    -9.826    0.7154         4
    1.000 2.361e+04     1.589     5.462     10.54    -3.049    0.2704      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      200     3.049     1.102     3.456     2.404    -9.184    0.7154         4
    1.000 9.494e+04     1.161     5.892     12.26    -1.760    0.2704      1004

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      300     3.477     1.102     3.670     3.260    -8.542    0.7154         4
    1.000 2.866e+05    0.7331     6.321     13.98   -0.4712    0.2704      1009

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      400     3.906     1.102     3.884     4.116    -7.901    0.7154         4
    1.000 8.008e+05    0.3052     6.750     15.70    0.8152    0.2704      1019

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      500     4.374     1.089     4.095     4.971    -7.256    0.7154         4
    1.000 2.204e+06   -0.1223     7.181     17.38     2.064    0.2704      1031

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      600     6.174     1.025     4.108     5.088    -7.152    0.4857         4
    1.000 1.461e+08   -0.1808     7.310     17.57     2.206    0.5001      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      700     5.672     1.135     4.074     4.844    -7.363    0.1092         4
    1.000 2.311e+08  -0.05878     7.369     17.54     2.301    0.8766      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      800     4.907     1.319     3.975     4.264    -7.844 6.543e-175         4
    1.000 3.021e+08    0.2314     7.712     20.25     4.749    0.9858      1033

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      900     4.285     1.360     3.764     3.378    -8.519 -1.079e-320         4
    1.000 3.059e+08    0.6742     7.950     21.03     5.285    0.9858      1047

    model     logdt      logL   logTeff     logPs     logρs    H_cntr     iters
     mass       age      logR     logTc     logPc     logρc   He_cntr     zones
-------------------------------------------------------------------------------
      962     4.040     1.376     3.632     2.832    -8.932 2.515e-321         4
    1.000 3.068e+08    0.9473     8.000     21.20     5.402    0.9858      1061

Reached maximum central temperature
614.199026 seconds (329.51 M allocations: 18.855 GiB, 0.77% gc time, 2.81% compilation time: 25% of which was recompilation)</code></pre><h2 id="Plotting-with-Makie"><a class="docs-heading-anchor" href="#Plotting-with-Makie">Plotting with Makie</a><a id="Plotting-with-Makie-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-with-Makie" title="Permalink"></a></h2><p>Now that our simulation is complete we can analyze the results. We make use of the Makie package for this. I&#39;m not a fan of the Makie defaults, so I adjust them.</p><pre><code class="language-julia hljs">using CairoMakie, LaTeXStrings
set_theme!(Plotting.basic_theme())</code></pre><h3 id="Compare-against-polytropes"><a class="docs-heading-anchor" href="#Compare-against-polytropes">Compare against polytropes</a><a id="Compare-against-polytropes-1"></a><a class="docs-heading-anchor-permalink" href="#Compare-against-polytropes" title="Permalink"></a></h3><p>Below we see how the profile of the star compares to different polytropes. We make use of the facility tools to obtain DataFrame objects out of the hdf5 output. In particular, <code>get_profile_names_from_hdf5</code> will provide the names of all profiles contained within the hdf5 file, while <code>get_profile_dataframe_from_hdf5</code> is used to obtain one DataFrame corresponding to one stellar profile. The animation is constructed using the <code>Observable</code> type that makie provides. Note that the zero points of the polytropes are arbitrary.</p><pre><code class="language-julia hljs">profile_names = StellarModels.get_profile_names_from_hdf5(&quot;profiles.hdf5&quot;)

f = Figure();
ax = Axis(f[1, 1]; xlabel=L&quot;\log_{10}(\rho/\text{[g\;cm^{-3}]})&quot;, ylabel=L&quot;\log_{10}(P/\text{[dyn]})&quot;)

pname = Observable(profile_names[1])

profile = @lift(StellarModels.get_profile_dataframe_from_hdf5(&quot;profiles.hdf5&quot;, $pname))
log10_ρ = @lift($profile[!, &quot;log10_rho&quot;])
log10_P = @lift($profile[!, &quot;log10_P&quot;])

profile_line = lines!(ax, log10_ρ, log10_P; label=&quot;real profile&quot;)
xvals = LinRange(-13, 4, 100)
lines!(ax, xvals, (1 + 1 / 1) .* xvals .+ 20; label=&quot;n=1&quot;)
lines!(ax, xvals, (1 + 1 / (1.5)) .* xvals .+ 15; label=&quot;n=1.5&quot;)
lines!(ax, xvals, (1 + 1 / 3) .* xvals .+ 15; label=&quot;n=3&quot;)
axislegend(ax; position=:rb)

model_number_str = @lift(&quot;model number=$(parse(Int,$pname))&quot;)
profile_text = text!(ax, -10, 20; text=model_number_str)

record(f, &quot;rho_P_evolution.gif&quot;, profile_names[1:end]; framerate=4) do profile_name
    pname[] = profile_name
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;rho_P_evolution.gif&quot;</code></pre><p><img src="../rho_P_evolution.gif" alt="Movie polytrope"/></p><h3 id="Check-nuclear-burning"><a class="docs-heading-anchor" href="#Check-nuclear-burning">Check nuclear burning</a><a id="Check-nuclear-burning-1"></a><a class="docs-heading-anchor-permalink" href="#Check-nuclear-burning" title="Permalink"></a></h3><p>We see that the structure evolves towards an n=3 polytrope. Deviations near the core are due to the non-homogeneous composition as hydrogen is burnt. We can similarly visualize how the hydrogen mass fraction changes in the simulation. In here, only one frame shows the hydrogen that was burnt. To better visualize that you can adjust <code>profile_interval</code> in the <a href="../Evolution/##Io.jl">IO</a> options (and probably adjust the framerate).</p><pre><code class="language-julia hljs">profile_names = StellarModels.get_profile_names_from_hdf5(&quot;profiles.hdf5&quot;)

f = Figure();
ax = Axis(f[1, 1]; xlabel=L&quot;\text{Mass}\;[M_\odot]&quot;, ylabel=L&quot;\text{Abundance}&quot;)

pname = Observable(profile_names[1])

profile = @lift(StellarModels.get_profile_dataframe_from_hdf5(&quot;profiles.hdf5&quot;, $pname))
mass = @lift($profile[!, &quot;mass&quot;])
X = @lift($profile[!, &quot;X&quot;])
Y = @lift($profile[!, &quot;Y&quot;])
model_number_str = @lift(&quot;model number=$(parse(Int,$pname))&quot;)

profile_line = lines!(ax, mass, X; label=&quot;X&quot;)
profile_line = lines!(ax, mass, Y; label=&quot;Y&quot;)
profile_text = text!(ax, 0.7, 0.95; text=model_number_str)
axislegend(ax; position=:rb)
ylims!(ax,-0.05,1.05)

record(f, &quot;X_evolution.gif&quot;, profile_names[1:end]; framerate=4) do profile_name
    pname[] = profile_name
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;X_evolution.gif&quot;</code></pre><p><img src="../X_evolution.gif" alt="Movie polytrope"/></p><h3 id="Plot-a-funny-HR-diagram"><a class="docs-heading-anchor" href="#Plot-a-funny-HR-diagram">Plot a funny HR diagram</a><a id="Plot-a-funny-HR-diagram-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-a-funny-HR-diagram" title="Permalink"></a></h3><p>Finally, we can also access the history data of the simulation. We use this to plot a simple HR diagram. As our microphysics are very simplistic, and the initial condition is not very physical, this looks a bit funny!</p><pre><code class="language-julia hljs">f = Figure();
ax = Axis(f[1, 1]; xlabel=L&quot;\log_{10}(T_\text{eff}/[K])&quot;, ylabel=L&quot;\log_{10}(L/L_\odot)&quot;, xreversed=true)
history = StellarModels.get_history_dataframe_from_hdf5(&quot;history.hdf5&quot;)
lines!(ax, log10.(history[!, &quot;T_surf&quot;]), log10.(history[!, &quot;L_surf&quot;]))
f</code></pre><img src="68b10b22.png" alt="Example block output"/><h3 id="Perform-some-cleanup"><a class="docs-heading-anchor" href="#Perform-some-cleanup">Perform some cleanup</a><a id="Perform-some-cleanup-1"></a><a class="docs-heading-anchor-permalink" href="#Perform-some-cleanup" title="Permalink"></a></h3><p>Internally we want to prevent storing any of the hdf5 files into our git repos, so I remove them. You can also take advantage of <code>julia</code> as a scripting language to post-process your simulation output in a similar way.</p><pre><code class="language-julia hljs">rm(&quot;history.hdf5&quot;)
rm(&quot;profiles.hdf5&quot;)
rm(&quot;example_options.toml&quot;)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../DualNumbers/">« DualSupport.jl</a><a class="docs-footer-nextpage" href="../Chem/">Chem »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 6 December 2025 08:34">Saturday 6 December 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
